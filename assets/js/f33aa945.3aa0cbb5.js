"use strict";(self.webpackChunk_ima_docs=self.webpackChunk_ima_docs||[]).push([[6911],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=p(n),u=o,h=d["".concat(l,".").concat(u)]||d[u]||m[u]||r;return n?a.createElement(h,s(s({ref:t},c),{},{components:n})):a.createElement(h,s({ref:t},c))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,s=new Array(r);s[0]=u;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[d]="string"==typeof e?e:o,s[1]=i;for(var p=2;p<r;p++)s[p]=n[p];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},1683:(e,t,n)=>{n.d(t,{Z:()=>s});var a=n(7294),o=n(8944);const r={tabItem:"tabItem_Ymn6"};function s(e){let{children:t,hidden:n,className:s}=e;return a.createElement("div",{role:"tabpanel",className:(0,o.Z)(r.tabItem,s),hidden:n},t)}},6745:(e,t,n)=>{n.d(t,{Z:()=>w});var a=n(5773),o=n(7294),r=n(8944),s=n(2466),i=n(3620),l=n(1980),p=n(7392),c=n(12);function d(e){return function(e){return o.Children.map(e,(e=>{if(!e||(0,o.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:n,attributes:a,default:o}}=e;return{value:t,label:n,attributes:a,default:o}}))}function m(e){const{values:t,children:n}=e;return(0,o.useMemo)((()=>{const e=t??d(n);return function(e){const t=(0,p.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function u(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function h(e){let{queryString:t=!1,groupId:n}=e;const a=(0,i.k6)(),r=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,l._X)(r),(0,o.useCallback)((e=>{if(!r)return;const t=new URLSearchParams(a.location.search);t.set(r,e),a.replace({...a.location,search:t.toString()})}),[r,a])]}function g(e){const{defaultValue:t,queryString:n=!1,groupId:a}=e,r=m(e),[s,i]=(0,o.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!u({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:t,tabValues:r}))),[l,p]=h({queryString:n,groupId:a}),[d,g]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[a,r]=(0,c.Nk)(n);return[a,(0,o.useCallback)((e=>{n&&r.set(e)}),[n,r])]}({groupId:a}),f=(()=>{const e=l??d;return u({value:e,tabValues:r})?e:null})();(0,o.useLayoutEffect)((()=>{f&&i(f)}),[f]);return{selectedValue:s,selectValue:(0,o.useCallback)((e=>{if(!u({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);i(e),p(e),g(e)}),[p,g,r]),tabValues:r}}var f=n(2389);const v={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function b(e){let{className:t,block:n,selectedValue:i,selectValue:l,tabValues:p}=e;const c=[],{blockElementScrollPositionUntilNextRender:d}=(0,s.o5)(),m=e=>{const t=e.currentTarget,n=c.indexOf(t),a=p[n].value;a!==i&&(d(t),l(a))},u=e=>{let t=null;switch(e.key){case"Enter":m(e);break;case"ArrowRight":{const n=c.indexOf(e.currentTarget)+1;t=c[n]??c[0];break}case"ArrowLeft":{const n=c.indexOf(e.currentTarget)-1;t=c[n]??c[c.length-1];break}}t?.focus()};return o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":n},t)},p.map((e=>{let{value:t,label:n,attributes:s}=e;return o.createElement("li",(0,a.Z)({role:"tab",tabIndex:i===t?0:-1,"aria-selected":i===t,key:t,ref:e=>c.push(e),onKeyDown:u,onClick:m},s,{className:(0,r.Z)("tabs__item",v.tabItem,s?.className,{"tabs__item--active":i===t})}),n??t)})))}function k(e){let{lazy:t,children:n,selectedValue:a}=e;const r=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=r.find((e=>e.props.value===a));return e?(0,o.cloneElement)(e,{className:"margin-top--md"}):null}return o.createElement("div",{className:"margin-top--md"},r.map(((e,t)=>(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==a}))))}function y(e){const t=g(e);return o.createElement("div",{className:(0,r.Z)("tabs-container",v.tabList)},o.createElement(b,(0,a.Z)({},e,t)),o.createElement(k,(0,a.Z)({},e,t)))}function w(e){const t=(0,f.Z)();return o.createElement(y,(0,a.Z)({key:String(t)},e))}},8366:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>p,toc:()=>d});var a=n(5773),o=(n(7294),n(3905)),r=n(6745),s=n(1683);const i={title:"Adding Some State",description:"Tutorial > Adding Some State"},l=void 0,p={unversionedId:"tutorial/adding-some-state",id:"tutorial/adding-some-state",title:"Adding Some State",description:"Tutorial > Adding Some State",source:"@site/../docs/tutorial/adding-some-state.mdx",sourceDirName:"tutorial",slug:"/tutorial/adding-some-state",permalink:"/tutorial/adding-some-state",draft:!1,editUrl:"https://github.com/seznam/ima/tree/master/docs/../docs/tutorial/adding-some-state.mdx",tags:[],version:"current",lastUpdatedBy:"PS",lastUpdatedAt:1736752325,formattedLastUpdatedAt:"Jan 13, 2025",frontMatter:{title:"Adding Some State",description:"Tutorial > Adding Some State"},sidebar:"tutorial",previous:{title:"Static View",permalink:"/tutorial/static-view"},next:{title:"Fetching Data",permalink:"/tutorial/fetching-data"}},c={},d=[{value:"Controller &amp; error handling",id:"controller--error-handling",level:2},{value:"Fetching posts",id:"fetching-posts",level:2},{value:"Splitting the render method",id:"splitting-the-render-method",level:3},{value:"Creating new components",id:"creating-new-components",level:2},{value:"Notes on communication between controllers and views",id:"notes-on-communication-between-controllers-and-views",level:2},{value:"Passing state",id:"passing-state",level:3},{value:"Emitting events using the EventBus",id:"emitting-events-using-the-eventbus",level:3},{value:"Emitting events using the Dispatcher",id:"emitting-events-using-the-dispatcher",level:3}],m={toc:d},u="wrapper";function h(e){let{components:t,...n}=e;return(0,o.kt)(u,(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"In ",(0,o.kt)("a",{parentName:"p",href:"/tutorial/static-view"},"previous section")," of the tutorial, we prepared basic markup and custom styling\nthanks to the ",(0,o.kt)("a",{parentName:"p",href:"https://getbootstrap.com/"},"Bootstrap CSS library"),".\nIn this section, we're going to add some functionality to our application."),(0,o.kt)("h2",{id:"controller--error-handling"},"Controller & error handling"),(0,o.kt)("p",null,"Our guestbook may look nice, but it is kind of boring since the posts are static\nand we cannot add new posts. So let's take care of this."),(0,o.kt)("p",null,"To begin, we'll render posts from data that we'll store as the state of our page\ncontroller. Open the ",(0,o.kt)("inlineCode",{parentName:"p"},"app/page/home/HomeController.js")," file and you'll see a class declaration."),(0,o.kt)("p",null,"You can notice that by default, our bootstrapped application includes some pre-defined\nmethods along with very long JSDoc comments. Feel free to read through these comments\nbut to make this tutorial simpler, we're going to replace contents of this file with following code:"),(0,o.kt)(r.Z,{mdxType:"Tabs"},(0,o.kt)(s.Z,{value:"JavaScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"import { AbstractController } from '@ima/core';\n\nexport class HomeController extends AbstractController {\n  static get $dependencies() {\n    return [];\n  }\n\n  constructor() {\n    super();\n  }\n\n  load() {\n    return {};\n  }\n\n  setMetaParams(loadedResources, metaManager, router, dictionary, settings) {\n    metaManager.setTitle('Guestbook');\n  }\n}\n"))),(0,o.kt)(s.Z,{value:"TypeScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},"import {\n  AbstractController,\n  Dependencies,\n  Dictionary,\n  LoadedResources,\n  MetaManager,\n  Router,\n  Settings,\n} from '@ima/core';\n\nexport type PostData = {\n  content: string;\n  author: string;\n};\nexport type HomeControllerState = {\n  posts: PostData[];\n};\n\nexport class HomeController extends AbstractController<HomeControllerState> {\n  static $dependencies: Dependencies = [];\n\n  constructor() {\n    super();\n  }\n\n  load(): HomeControllerState<HomeControllerState> {\n    return {};\n  }\n\n  setMetaParams(\n    loadedResources: LoadedResources,\n    metaManager: MetaManager,\n    router: Router,\n    dictionary: Dictionary,\n    settings: Settings\n  ): void {\n    metaManager.setTitle('Guestbook');\n  }\n}\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"TypeScript:")," As you can see, the TypeScript code is a lot more complex.\nThe main reason is adding types ",(0,o.kt)("inlineCode",{parentName:"p"},"PostData")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"HomeControllerState")," that we will use later in this course.")))),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"AbstractController")," class defines some methods which are executed\nin different parts of it's lifecycle, you can ",(0,o.kt)("a",{parentName:"p",href:"/basic-features/controller-lifecycle"},"read more about this in the documentation"),"\nOne of the main methods you're going to use frequently is the ",(0,o.kt)("inlineCode",{parentName:"p"},"load()")," method."),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"load()")," method is called automatically\nby IMA.js when the controller is being initialized. It returns a hash object - a plain\nJavaScript object representing a map of keys and values - representing the initial\nstate of the page. The values in the returned object may be\n",(0,o.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise"},"promises")," or scalar values.\nThe IMA.js will wait for all promises to resolve before rendering the page,\nallowing us to fetch any data we may need from the server."),(0,o.kt)("p",null,"Once all promises are resolved, IMA.js sets the controller's view state to the\nhash object with promises replaced by the values the promises resolved to."),(0,o.kt)("p",null,"In case that a promise gets rejected, we may want to display a specific error\npage. It is recommended to reject the load promises using IMA.js'\n",(0,o.kt)("inlineCode",{parentName:"p"},"GenericError")," (located in the module ",(0,o.kt)("inlineCode",{parentName:"p"},"@ima/error/GenericError"),"), which\nallows you to specify the HTTP status code representing the error type,\nresulting in the appropriate error page being displayed. An example usage\nof the ",(0,o.kt)("inlineCode",{parentName:"p"},"load()")," method is show below:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"load() {\n  return {\n    ourPageData: fetchUsefulData(params).catch((error) => {\n      // Note: the fetchUsefulData() should already return a promise\n      // rejected by GenericError in case an error occurs, so we would not\n      // have to do this in our every controller using a function like\n      // this one.\n\n      if (error.name === 'NotFoundError') {\n        throw new GenericError('No such records exist', {\n          cause: error,\n          params: params,\n          status: 404 // The 404 HTTP status stands for \"Not Found\"\n        });\n      } else {\n        throw new GenericError('Cannot retrieve data', {\n          cause: error,\n          params: params,\n          status: 500 // The 500 HTTP status stands for \"Internal Server Error\"\n        });\n      }\n    })\n  };\n}\n")),(0,o.kt)("p",null,"Now you may be tempted to simply extend the native ",(0,o.kt)("inlineCode",{parentName:"p"},"Error")," class (or one of its\nsiblings). The problem with that is that all browsers do not generate stack\ntraces for custom errors extending the native ones (unless you are using a\nbrowser that has already implemented error sub-classing). The ",(0,o.kt)("inlineCode",{parentName:"p"},"GenericError"),"\ntakes care of this for us and also allows you\nto create custom error classes by extending the ",(0,o.kt)("inlineCode",{parentName:"p"},"GenericError")," class while still\nhaving access to stack traces of your errors."),(0,o.kt)("h2",{id:"fetching-posts"},"Fetching posts"),(0,o.kt)("p",null,"But let's refocus on the ",(0,o.kt)("inlineCode",{parentName:"p"},"load()")," method in our controller. For now, we'll\nspecify our data statically and take care of fetching the data from the server in\na later point in this tutorial. Replace the contents of the ",(0,o.kt)("inlineCode",{parentName:"p"},"load()")," method with\nthe following code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"return {\n  posts: [\n    {\n      content: 'Never mistake motion for action.',\n      author: 'Ernest Hemingway'\n    },\n    {\n      content: 'Quality means doing it right when no one is looking.',\n      author: 'Henry Ford'\n    },\n    {\n      content:\n        'We are what we repeatedly do. Excellence, then, is not an act, but a habit.',\n      author: 'Aristotle'\n    },\n    {\n      content:\n        'Reality is merely an illusion, albeit a very persistent one.',\n      author: 'Albert Einstein'\n    }\n  ]\n};\n")),(0,o.kt)("p",null,"As you may have noticed, we used JSON-compatible code in case of ",(0,o.kt)("inlineCode",{parentName:"p"},"posts")," - this\nwill come in handy later when we'll introduce fetching the data from the\nserver and move the structure to an external JSON file."),(0,o.kt)("h3",{id:"splitting-the-render-method"},"Splitting the render method"),(0,o.kt)("p",null,"Let's return to our view in the ",(0,o.kt)("inlineCode",{parentName:"p"},"app/page/home/HomeView.jsx")," file. Replace the\n",(0,o.kt)("inlineCode",{parentName:"p"},"render()")," method with the following code snippet:"),(0,o.kt)(r.Z,{mdxType:"Tabs"},(0,o.kt)(s.Z,{value:"JavaScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'render() {\n  return (\n    <div className="l-home container">\n      <h1>Guestbook</h1>\n      <div className="posting-form card">\n        <form action="" method="post">\n          <h5 className="card-header">Add a post</h5>\n          <div className="card-body">\n            <div className="form-group">\n              <label htmlFor="postForm-name">Name:</label>\n              <input\n                id="postForm-name"\n                className="form-control"\n                type="text"\n                name="author"\n                placeholder="Your name"\n              />\n            </div>\n            <div className="form-group">\n              <label htmlFor="postForm-content">Post:</label>\n              <textarea\n                id="postForm-content"\n                className="form-control"\n                name="content"\n                placeholder="What would you like to tell us?"\n              />\n            </div>\n          </div>\n          <div className="card-footer">\n            <button type="submit" className="btn btn btn-outline-primary">\n              Submit\n              <div className="ripple-wrapper" />\n            </button>\n          </div>\n        </form>\n      </div>\n      <hr />\n      <div className="posts">\n        <h2>Posts</h2>\n        {this._renderPosts()}\n      </div>\n    </div>\n  );\n}\n\n_renderPosts() {\n  const { posts } = this.props;\n\n  return posts.map((post, index) => (\n    <div className="post card card-default" key={index}>\n      <div className="card-body">{post.content}</div>\n      <div className="post-author card-footer">{post.author}</div>\n    </div>\n  ));\n}\n'))),(0,o.kt)(s.Z,{value:"TypeScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"import './homeView.less';\nimport { PostData } from 'app/page/home/HomeController';\nimport { usePageContext } from '@ima/react-page-renderer';\n\ntype HomeViewProps = {\n  posts: PostData[];\n};\n\nexport function HomeView({ posts }: HomeViewProps) {\n  const _pageContext = usePageContext();\n\n  const _renderPosts = () => {\n    return posts.map((post: PostData, index) => (\n      <div className='post card card-default' key={index}>\n        <div className='card-body'>{post.content}</div>\n        <div className='post-author card-footer'>{post.author}</div>\n      </div>\n    ));\n  };\n\n  return (\n    <div className='l-home container'>\n      <h1>Guestbook</h1>\n\n      <div className='posting-form card'>\n        <form action='' method='post'>\n          <h5 className='card-header'>Add a post</h5>\n          <div className='card-body'>\n            <div className='form-group'>\n              <label htmlFor='postForm-name'>Name:</label>\n              <input\n                id='postForm-name'\n                className='form-control'\n                type='text'\n                name='author'\n                placeholder='Your name'\n              />\n            </div>\n            <div className='form-group'>\n              <label htmlFor='postForm-content'>Post:</label>\n              <textarea\n                id='postForm-content'\n                className='form-control'\n                name='content'\n                placeholder='What would you like to tell us?'\n              />\n            </div>\n          </div>\n          <div className='card-footer'>\n            <button type='submit' className='btn btn btn-outline-primary'>\n              Submit\n              <div className='ripple-wrapper' />\n            </button>\n          </div>\n        </form>\n      </div>\n      <hr />\n      <div className='posts'>\n        <h2>Posts</h2>\n        {_renderPosts()}\n      </div>\n    </div>\n  );\n}\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"TypeScript: ")," New type ",(0,o.kt)("inlineCode",{parentName:"p"},"HomeViewProps")," has been used to correctly accept typed props in our ",(0,o.kt)("inlineCode",{parentName:"p"},"HomeView"),".")))),(0,o.kt)("p",null,"We have replaced the old sequence of\n",(0,o.kt)("inlineCode",{parentName:"p"},"<div className='post card card-default'>")," tags with the\n",(0,o.kt)("inlineCode",{parentName:"p"},"{this._renderPosts()}")," expression, which tells React to insert the return\nvalue of our new ",(0,o.kt)("inlineCode",{parentName:"p"},"_renderPosts()")," method."),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"_renderPosts()")," method traverses the array of posts available as\n",(0,o.kt)("inlineCode",{parentName:"p"},"this.props.posts")," (",(0,o.kt)("inlineCode",{parentName:"p"},"this.props")," refers to the page controller's state in\npage views) and creates a new array containing the rendered posts. Notice\nthat we are using ",(0,o.kt)("inlineCode",{parentName:"p"},"props")," instead of ",(0,o.kt)("inlineCode",{parentName:"p"},"state")," in our view because we are\nreferencing external data, not the internal state of our view component."),(0,o.kt)("p",null,"The structure of the UI representing a post has had its static content\nreplaced with the ",(0,o.kt)("inlineCode",{parentName:"p"},"{post.content}")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"{post.author}")," expressions injecting\nthe content and the author of the post, and we have added a new ",(0,o.kt)("inlineCode",{parentName:"p"},"key={index}"),"\nattribute (technically, it is a React element property, but we'll use the XML\nterminology in this tutorial). The ",(0,o.kt)("inlineCode",{parentName:"p"},"key")," attribute is required by React to help\nit identify parts of the DOM, therefore its value must be unique within the\ncontext and represent a relationship between the DOM fragment and the data.\nHere we set it to the index of the current post in the ",(0,o.kt)("inlineCode",{parentName:"p"},"posts")," array."),(0,o.kt)("p",null,"In practice you should not use array indexes as keys because shifting or\nmodifying the contents of the array will result in using the same keys for\ndifferent items in each rendering, which will result in a strange and quirky\nbehavior, especially for components with their own state. It is best to use\nunique identifiers, such as the primary key of the record provided by the\ndatabase."),(0,o.kt)("p",null,"Since we do not have the posts stored in an actual database, we're going to\nhelp ourselves in a different way, but we'll address that later in this\ntutorial."),(0,o.kt)("h2",{id:"creating-new-components"},"Creating new components"),(0,o.kt)("p",null,"Now the view looks better, but it's still not perfect, because the view still\nfeels bulky. To fix that, we start by moving the post rendering to a new\ncomponent."),(0,o.kt)("p",null,"Create the ",(0,o.kt)("inlineCode",{parentName:"p"},"app/component/post")," directory and the ",(0,o.kt)("inlineCode",{parentName:"p"},"app/component/post/Post.jsx"),"\nand ",(0,o.kt)("inlineCode",{parentName:"p"},"app/component/post/post.less")," files."),(0,o.kt)("p",null,"Put the following code into the ",(0,o.kt)("inlineCode",{parentName:"p"},"Post.jsx")," file:"),(0,o.kt)(r.Z,{mdxType:"Tabs"},(0,o.kt)(s.Z,{value:"JavaScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"import { AbstractComponent } from '@ima/react-page-renderer';\nimport React from 'react';\nimport './post.less';\n\n\nexport default class Post extends AbstractComponent {\n  render() {\n    const { content, author } = this.props;\n\n    return (\n      <div className=\"post card card-default\">\n        <div className=\"card-body\">{content}</div>\n        <div className=\"post-author card-footer\">{author}</div>\n      </div>\n    );\n  }\n}\n"))),(0,o.kt)(s.Z,{value:"TypeScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"import './post.less';\n\ntype PostProps = {\n  content: string;\n  author: string;\n};\n\nexport function Post({ content, author }: PostProps) {\n  return (\n    <div className='post card card-default'>\n      <div className='card-body'>{content}</div>\n      <div className='post-author card-footer'>{author}</div>\n    </div>\n  );\n}\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"TypeScript: ")," With ",(0,o.kt)("inlineCode",{parentName:"p"},"PostProps")," type, in TypeScript we can directly destructure the props in the function\nparameters and use their single attributes in the return function.")))),(0,o.kt)("p",null,"In this component we access the post content and author name in our ",(0,o.kt)("inlineCode",{parentName:"p"},"render()"),"\nmethod using the ",(0,o.kt)("inlineCode",{parentName:"p"},"this.props")," object, which contains a hash object of\nproperties passed to the React component by whatever code is using it."),(0,o.kt)("p",null,"To use our new component, we need to update the ",(0,o.kt)("inlineCode",{parentName:"p"},"_renderPosts()")," method in the\n",(0,o.kt)("inlineCode",{parentName:"p"},"app/page/home/HomeView.jsx")," file to the following code:"),(0,o.kt)(r.Z,{mdxType:"Tabs"},(0,o.kt)(s.Z,{value:"JavaScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"return posts.map((post, index) => {\n  return <Post key={index} content={post.content} author={post.author} />;\n});\n"))),(0,o.kt)(s.Z,{value:"TypeScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"return posts.map((post: PostData, index) => (\n  <Post key={index} content={post.content} author={post.author} />\n));\n")))),(0,o.kt)("p",null,"...and import the ",(0,o.kt)("inlineCode",{parentName:"p"},"Post")," component by adding the following import to the\nbeginning of the file:"),(0,o.kt)(r.Z,{mdxType:"Tabs"},(0,o.kt)(s.Z,{value:"JavaScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"import Post from 'app/component/post/Post';\n"))),(0,o.kt)(s.Z,{value:"TypeScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Post } from 'app/component/post/Post';\n")))),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Note"),": You can notice that so far we ",(0,o.kt)("strong",{parentName:"p"},"haven't used relative imports")," when importing\nour custom JS modules from inside of the app directory structure. This is\nbecause IMA.js adds the ",(0,o.kt)("inlineCode",{parentName:"p"},"app")," directory to the ",(0,o.kt)("strong",{parentName:"p"},"lookup path"),". This means that\nyou can refer to any file inside ",(0,o.kt)("inlineCode",{parentName:"p"},"app")," directory through an absolute path,\nwhich makes most of the imports much cleaner.")),(0,o.kt)("p",null,"To finish the creation of the post component, we need to move the related\nstyles from ",(0,o.kt)("inlineCode",{parentName:"p"},"app/page/home/homeView.less")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"app/component/post/post.less"),".\nMove the following code to the ",(0,o.kt)("inlineCode",{parentName:"p"},"post.less")," file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-scss"},".post-author {\n  text-align: @post-author-alignment;\n  font-style: italic;\n  font-size: 85%;\n}\n")),(0,o.kt)("p",null,'We can further improve our page view structure by refactoring-out the\n"new post" form to a separate component. Create the ',(0,o.kt)("inlineCode",{parentName:"p"},"app/component/postingForm"),"\ndirectory and the ",(0,o.kt)("inlineCode",{parentName:"p"},"app/component/postingForm/PostingForm.jsx")," file. Then, put the\nfollowing code into the ",(0,o.kt)("inlineCode",{parentName:"p"},"app/component/postingForm/PostingForm.jsx")," file:"),(0,o.kt)(r.Z,{mdxType:"Tabs"},(0,o.kt)(s.Z,{value:"JavaScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'import { AbstractComponent } from \'@ima/react-page-renderer\';\nimport React from \'react\';\n\nexport default class PostingForm extends AbstractComponent {\n  render() {\n    return (\n      <div className="posting-form card">\n        <form action="" method="post">\n          <h5 className="card-header">Add a post</h5>\n          <div className="card-body">\n            <div className="form-group">\n              <label htmlFor="postForm-name">Name:</label>\n              <input\n                id="postForm-name"\n                className="form-control"\n                type="text"\n                name="author"\n                placeholder="Your name"\n              />\n            </div>\n            <div className="form-group">\n              <label htmlFor="postForm-content">Post:</label>\n              <textarea\n                id="postForm-content"\n                className="form-control"\n                name="content"\n                placeholder="What would you like to tell us?"\n              />\n            </div>\n          </div>\n          <div className="card-footer">\n            <button type="submit" className="btn btn btn-outline-primary">\n              Submit\n              <div className="ripple-wrapper" />\n            </button>\n          </div>\n        </form>\n      </div>\n    );\n  }\n}\n'))),(0,o.kt)(s.Z,{value:"TypeScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"export function PostingForm() {\n  return (\n    <div className='posting-form card'>\n      <form action='' method='post'>\n        <h5 className='card-header'>Add a post</h5>\n        <div className='card-body'>\n          <div className='form-group'>\n            <label htmlFor='postForm-name'>Name:</label>\n            <input\n              id='postForm-name'\n              className='form-control'\n              type='text'\n              name='author'\n              placeholder='Your name'\n            />\n          </div>\n          <div className='form-group'>\n            <label htmlFor='postForm-content'>Post:</label>\n            <textarea\n              id='postForm-content'\n              className='form-control'\n              name='content'\n              placeholder='What would you like to tell us?'\n            />\n          </div>\n        </div>\n        <div className='card-footer'>\n          <button type='submit' className='btn btn btn-outline-primary'>\n            Submit\n            <div className='ripple-wrapper' />\n          </button>\n        </div>\n      </form>\n    </div>\n  );\n}\n")))),(0,o.kt)("p",null,"Nothing new here, we just extracted the code from home controller's view and\nput it into a new React component."),(0,o.kt)("p",null,"Now update the ",(0,o.kt)("inlineCode",{parentName:"p"},"render()")," method in the home controller's view:"),(0,o.kt)(r.Z,{mdxType:"Tabs"},(0,o.kt)(s.Z,{value:"JavaScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'return (\n  <div className="l-home container">\n    <h1>Guestbook</h1>\n    <PostingForm />\n\n    <hr />\n\n    <div className="posts">\n      <h2>Posts</h2>\n      {this._renderPosts()}\n    </div>\n  </div>\n);\n'))),(0,o.kt)(s.Z,{value:"TypeScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"return (\n  <div className='l-home container'>\n    <h1>Guestbook</h1>\n    <PostingForm />\n\n    <hr />\n\n    <div className='posts'>\n      <h2>Posts</h2>\n      {_renderPosts()}\n    </div>\n  </div>\n);\n")))),(0,o.kt)("p",null,"To finish up, import the posting form component:"),(0,o.kt)(r.Z,{mdxType:"Tabs"},(0,o.kt)(s.Z,{value:"JavaScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"import PostingForm from 'app/component/postingForm/PostingForm';\n"))),(0,o.kt)(s.Z,{value:"TypeScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"import { PostingForm } from 'app/component/postingForm/PostingForm';\n")))),(0,o.kt)("p",null,"So far we've been ",(0,o.kt)("strong",{parentName:"p"},"only refactoring our code and moving few bits around")," to make it cleaner.\nWhen you refresh the page, you should see the same page as you ended up with after the end of\nthe previous tutorial."),(0,o.kt)("p",null,"Now that our code looks much cleaner, we can look into fetching the guestbook\nposts from the server. However, if you'd like to linger a little longer and\nlearn more how the controller and view communicate by passing state, check out\nthe following optional section ",(0,o.kt)("a",{parentName:"p",href:"#notes-on-communication-between-controllers-and-views"},"Notes on communication between controllers and\nviews"),"."),(0,o.kt)("h2",{id:"notes-on-communication-between-controllers-and-views"},"Notes on communication between controllers and views"),(0,o.kt)("p",null,"There are three ways the controllers and views communicate:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"By passing state from the controller to the view ","\u2013")," this is the most\ncommon way of passing information."),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"By emitting DOM events")," from the view and listening for them in the controller\nor parent components (using the ",(0,o.kt)("inlineCode",{parentName:"li"},"EventBus"),") ","\u2013"," this is\nthe most common way of notifying the controller or a parent UI component of\nthe user's actions in the view."),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},'By emitting "global" events')," in the controller and / or view and listening for\nthem in the controller and / or view (using the ",(0,o.kt)("inlineCode",{parentName:"li"},"Dispatcher"),")\n","\u2013"," this is used only in very specific situations, like when the UI\nneeds to be notified about an external event captured by the controller and\nupdating the state is not practical.")),(0,o.kt)("h3",{id:"passing-state"},"Passing state"),(0,o.kt)("p",null,"The controller creates the initial state of the page by returning a hash object\nof values and promises from its ",(0,o.kt)("inlineCode",{parentName:"p"},"load()")," method. The IMA.js then waits for all\nthe promises to resolve at the server, pass the resulting values as properties\nto the page view component, and renders the page to send it to the client."),(0,o.kt)("p",null,'The situation is a little more complicated at the client-side however. When the\npage is being "re-animated" after being rendered at the server-side, the IMA.js\nuses the controller\'s ',(0,o.kt)("inlineCode",{parentName:"p"},"load()")," method and the returned object in the same way,\nthough the promises are usually resolved immediately using the data in the\ncache sent to the client along with the rendered page."),(0,o.kt)("p",null,"When the user navigates between pages, however, the IMA.js does not wait for\nall promises to resolve before rendering the new view. The IMA.js registers\ncallbacks on all returned promises, and whenever one of the promises resolves,\nIMA.js pushes the currently resolved fragment of the page state to the view."),(0,o.kt)("p",null,"On one hand, this allows you to display content as it loads (providing it is\ndecoupled) while displaying loading indicators where the content is not\navailable yet. On the other hand, this does require you to add more logic to\nyour view, checking whether the data is available or not, and displaying\nloading indicators where the data is not available yet."),(0,o.kt)("h3",{id:"emitting-events-using-the-eventbus"},"Emitting events using the EventBus"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"EventBus")," API allows your UI components to emit custom DOM\nevents that naturally propagate through the DOM tree representing the tree of\nyour UI components."),(0,o.kt)("p",null,"This is usually used to notify the parent components of user interaction with\ncustom controls in your UI, or to notify the page controller itself."),(0,o.kt)("p",null,"The custom events may have any name and carry arbitrary data that are not\nrestricted to JSON-serializable values."),(0,o.kt)("p",null,"Furthermore, the controllers can easily listen for the events dispatched using\nthe EventBus (unless the propagation of the event is stopped by a component\nhalf the way) by declaring event listener methods."),(0,o.kt)("p",null,"An event listener method is a method of a controller named by the first-letter\ncapitalized event name with the ",(0,o.kt)("inlineCode",{parentName:"p"},"on")," prefix, for example the ",(0,o.kt)("inlineCode",{parentName:"p"},"formSubmitted"),"\nevent can be listened for by defining the ",(0,o.kt)("inlineCode",{parentName:"p"},"onFormSubmitted()")," method on your\ncontroller."),(0,o.kt)("p",null,"The first argument passed into the controller's event listener method will be\nthe event data, not the event object itself, as manipulating the event object\nonce it reaches the controller is pointless."),(0,o.kt)("h3",{id:"emitting-events-using-the-dispatcher"},"Emitting events using the Dispatcher"),(0,o.kt)("p",null,"The obvious limitation of the ",(0,o.kt)("inlineCode",{parentName:"p"},"EventBus")," API is that it only allows\nto create events that propagate up the tree of the UI components. The common\nway to propagate event in other directions, or to other parts of the UI, or\nfrom the controller to the UI is using the ",(0,o.kt)("inlineCode",{parentName:"p"},"Dispatcher")," API."),(0,o.kt)("p",null,"The Dispatcher allows any UI component and controller to register and\nderegister event listeners for arbitrarily named events and fire these events\nwith arbitrary data."),(0,o.kt)("p",null,"The events propagate directly to the registered event listeners with no way to\nstop their propagation."),(0,o.kt)("p",null,"Note that events distributed using the Dispatcher are useful only in very\nspecific use-cases, so the Dispatcher logs a warning to the console if there\nare no listeners registered for the fired event in order to notify you of\npossible typos in event names."),(0,o.kt)("p",null,"As always, you can learn more about ",(0,o.kt)("inlineCode",{parentName:"p"},"EventBus")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Dispatcher")," ",(0,o.kt)("a",{parentName:"p",href:"/basic-features/events"},"in the documentation")))}h.isMDXComponent=!0}}]);