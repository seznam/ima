"use strict";(globalThis.webpackChunk_ima_docs=globalThis.webpackChunk_ima_docs||[]).push([[1114],{3023:(e,r,n)=>{n.d(r,{R:()=>o,x:()=>l});var s=n(3696);const t={},i=s.createContext(t);function o(e){const r=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(i.Provider,{value:r},e.children)}},4043:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"basic-features/json-controllers","title":"JSON Controllers","description":"Basic features > JSON Controllers and Server-Only Code","source":"@site/../docs/basic-features/json-controllers.md","sourceDirName":"basic-features","slug":"/basic-features/json-controllers","permalink":"/basic-features/json-controllers","draft":false,"unlisted":false,"editUrl":"https://github.com/seznam/ima/tree/master/docs/../docs/basic-features/json-controllers.md","tags":[],"version":"current","lastUpdatedBy":"Filip Satek","lastUpdatedAt":1763983068000,"frontMatter":{"title":"JSON Controllers","description":"Basic features > JSON Controllers and Server-Only Code"},"sidebar":"docs","previous":{"title":"Object Container","permalink":"/basic-features/object-container"},"next":{"title":"Rendering process","permalink":"/basic-features/rendering-process"}}');var t=n(2540),i=n(3023);const o={title:"JSON Controllers",description:"Basic features > JSON Controllers and Server-Only Code"},l="JSON Controllers and Server-Only Code",c={},d=[{value:"Setting Up a JSON Controller",id:"setting-up-a-json-controller",level:2},{value:"Example",id:"example",level:3},{value:"Routing",id:"routing",level:2},{value:"The &#39;use server&#39; Directive",id:"the-use-server-directive",level:2},{value:"Current Limitations",id:"current-limitations",level:3},{value:"Error Handling",id:"error-handling",level:3},{value:"Best Practices",id:"best-practices",level:2}];function a(e){const r={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.header,{children:(0,t.jsx)(r.h1,{id:"json-controllers-and-server-only-code",children:"JSON Controllers and Server-Only Code"})}),"\n",(0,t.jsxs)(r.p,{children:["IMA.js supports server-only controllers that can return JSON responses directly, without rendering HTML. This is achieved by setting the ",(0,t.jsx)(r.code,{children:"$responseType"})," to ",(0,t.jsx)(r.code,{children:"'json'"})," on the controller."]}),"\n",(0,t.jsxs)(r.p,{children:["This feature is useful for API-like routes within your IMA application. By using ",(0,t.jsx)(r.code,{children:"'use server'"})," directive, you can optimize bundle size by preventing server-specific code from being shipped to the client."]}),"\n",(0,t.jsx)(r.h2,{id:"setting-up-a-json-controller",children:"Setting Up a JSON Controller"}),"\n",(0,t.jsx)(r.p,{children:"To create a server-only JSON controller:"}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsxs)(r.li,{children:["Add the ",(0,t.jsx)(r.code,{children:"'use server'"})," directive at the top of your controller file ",(0,t.jsx)(r.em,{children:"(optional but recommended)"}),"."]}),"\n",(0,t.jsxs)(r.li,{children:["Set the static ",(0,t.jsx)(r.code,{children:"$responseType"})," property to ",(0,t.jsx)(r.code,{children:"'json'"})," on your controller class."]}),"\n",(0,t.jsxs)(r.li,{children:["Implement the ",(0,t.jsx)(r.code,{children:"load"})," method to return the JSON data. ",(0,t.jsxs)(r.strong,{children:["Everything returned from the ",(0,t.jsx)(r.code,{children:"load"})," method will be sent as JSON response."]})]}),"\n"]}),"\n",(0,t.jsx)(r.h3,{id:"example",children:"Example"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-javascript",children:"'use server';\n\nimport { AbstractController, GenericError } from '@ima/core';\n\nexport default class JsonController extends AbstractController {\n  static $responseType = 'json';\n\n  async load() {\n    return {\n      data: 'This is JSON data from the server',\n    };\n  }\n}\n"})}),"\n",(0,t.jsx)(r.h2,{id:"routing",children:"Routing"}),"\n",(0,t.jsx)(r.p,{children:"Define routes for your JSON controllers as usual, but they will now return JSON instead of HTML."}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-javascript",children:"export const initRoutes = (ns, oc, routesConfig, router) =>\n  router\n    .add('json', '/json', JSONController, () => null);\n"})}),"\n",(0,t.jsx)(r.admonition,{type:"tip",children:(0,t.jsxs)(r.p,{children:["Use anonymous function that returns ",(0,t.jsx)(r.code,{children:"null"})," to avoid creating a view for the controller."]})}),"\n",(0,t.jsxs)(r.p,{children:["When accessing ",(0,t.jsx)(r.code,{children:"/json"}),", the server will respond with JSON from the ",(0,t.jsx)(r.code,{children:"load"})," method."]}),"\n",(0,t.jsx)(r.h2,{id:"the-use-server-directive",children:"The 'use server' Directive"}),"\n",(0,t.jsxs)(r.p,{children:["The ",(0,t.jsx)(r.code,{children:"'use server'"})," directive indicates that the file contains server-only code. During the build process:"]}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"On the server bundle, the code remains intact."}),"\n",(0,t.jsxs)(r.li,{children:["On the client bundle, the code is stubbed out:","\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["Controller ",(0,t.jsx)(r.code,{children:"load"})," methods throw a 404 error if called."]}),"\n",(0,t.jsx)(r.li,{children:"Other exports are replaced with stubs that throw errors when invoked."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:"This prevents server-only logic from leaking to the client and reduces bundle size."}),"\n",(0,t.jsx)(r.h3,{id:"current-limitations",children:"Current Limitations"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"While this works for any file in the bundle, the primary use case is for JSON controllers."}),"\n",(0,t.jsx)(r.li,{children:"It stubs any exports from the file, removing implementations in client bundles."}),"\n",(0,t.jsx)(r.li,{children:"Ensure routes using these controllers are properly configured in your router."}),"\n"]}),"\n",(0,t.jsx)(r.h3,{id:"error-handling",children:"Error Handling"}),"\n",(0,t.jsxs)(r.p,{children:["If a client attempts to load a server-only controller, it will throw a ",(0,t.jsx)(r.code,{children:"GenericError"})," with a 404 status."]}),"\n",(0,t.jsxs)(r.p,{children:["For more details on error handling, see ",(0,t.jsx)(r.a,{href:"/basic-features/error-handling",children:"error-handling.md"}),"."]}),"\n",(0,t.jsx)(r.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"Use this for API endpoints within your Application."}),"\n",(0,t.jsx)(r.li,{children:"Combine with authentication and authorization as needed."}),"\n",(0,t.jsx)(r.li,{children:"Test server and client behaviors separately."}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:"This feature enhances IMA.js's flexibility for mixed SSR and API scenarios while maintaining optimal client bundles."})]})}function h(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}}}]);