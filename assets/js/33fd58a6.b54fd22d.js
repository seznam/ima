"use strict";(self.webpackChunk_ima_docs=self.webpackChunk_ima_docs||[]).push([[633],{4792:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>a,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"migration/migration-0.15.0","title":"Migration 0.15.0","description":"Migration > Migration to version 0.15.0","source":"@site/../docs/migration/migration-0.15.0.md","sourceDirName":"migration","slug":"/migration/migration-0.15.0","permalink":"/migration/migration-0.15.0","draft":false,"unlisted":false,"editUrl":"https://github.com/seznam/ima/tree/master/docs/../docs/migration/migration-0.15.0.md","tags":[],"version":"current","lastUpdatedBy":"Jan \u0160ime\u010dek","lastUpdatedAt":1761308686000,"frontMatter":{"title":"Migration 0.15.0","description":"Migration > Migration to version 0.15.0"},"sidebar":"docs","previous":{"title":"Migration 0.14.0","permalink":"/migration/migration-0.14.0"},"next":{"title":"Migration 0.16.0","permalink":"/migration/migration-0.16.0"}}');var i=s(2540),r=s(3023);const a={title:"Migration 0.15.0",description:"Migration > Migration to version 0.15.0"},o=void 0,l={},c=[{value:"Build",id:"build",level:2},{value:"Karma removed instead of that added Jest",id:"karma-removed-instead-of-that-added-jest",level:3},{value:"Server",id:"server",level:2},{value:"DocumentView",id:"documentview",level:2},{value:"SPA",id:"spa",level:2},{value:"Removed namespaces",id:"removed-namespaces",level:2},{value:"Others",id:"others",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"In order to upgrade to IMA.js 0.15.0, start ba adding these new dependencies to package.json:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'"prop-types": "15.6.0",\n"react": "16.2.0",\n"react-dom": "16.2.0",\n"express-http-proxy": "^1.0.7"\n'})}),"\n",(0,i.jsx)(n.h2,{id:"build",children:"Build"}),"\n",(0,i.jsx)(n.p,{children:"If you are overriding polyfills or shims (for example using some custom polyfills) you need to change polyfills or shims structure in gulpConfig.js . Now it has to be structure for js, es and fetch polyfills.\nIf you are't overriding polyfills or shims, you can skip this step."}),"\n",(0,i.jsx)(n.p,{children:"Example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"shim: {\n  js: {\n    name: 'shim.js',\n    src: ['./node_modules/ima/polyfill/collectionEnumeration.js'],\n    dest: {\n    client: './build/static/js/'\n    }\n  },\n  es: {\n    name: 'shim.es.js',\n    src: [],\n    dest: {\n    client: './build/static/js/',\n    server: './build/ima/'\n    }\n  }\n\n\npolyfill: {\n  js: {\n    name: 'polyfill.js',\n    src: [\n    './node_modules/babel-polyfill/dist/polyfill.min.js',\n    './node_modules/custom-event-polyfill/custom-event-polyfill.js'\n    ],\n    dest: {\n    client: './build/static/js/'\n    }\n  },\n  es: {\n    name: 'polyfill.es.js',\n    src: ['./node_modules/custom-event-polyfill/custom-event-polyfill.js'],\n    dest: {\n    client: './build/static/js/'\n    }\n  },\n  fetch: {\n    name: 'fetch-polyfill.js',\n    src: [\n    './node_modules/core-js/client/shim.min.js',\n    './node_modules/whatwg-fetch/fetch.js'\n    ],\n    dest: {\n    client: './build/static/js/'\n    }\n  },\n  ima: {\n    name: 'ima-polyfill.js',\n    src: [\n    './node_modules/ima/polyfill/imaLoader.js',\n    './node_modules/ima/polyfill/imaRunner.js'\n    ],\n    dest: {\n    client: './build/static/js/'\n    }\n  }\n  }\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"In build.js add new property 'es' to bundle object:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"es: [\n  './build/static/js/polyfill.es.js',\n  './build/static/js/shim.es.js',\n  './build/static/js/vendor.client.es.js',\n  './build/static/js/app.client.es.js'\n]\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Add to your settings.js ",(0,i.jsx)(n.strong,{children:"prod"}),".$Page.$Render new property esScripts like this:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"esScripts: [\n  '/static/js/locale/' + config.$Language + '.js' + versionStamp,\n  '/static/js/app.bundle.es.min.js' + versionStamp\n]\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Add to your settings.js ",(0,i.jsx)(n.strong,{children:"dev"}),".$Page.$Render new property esScripts like this:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"esScripts: [\n  '/static/js/polyfill.es.js' + versionStamp,\n  '/static/js/shim.es.js' + versionStamp,\n  '/static/js/vendor.client.es.js' + versionStamp,\n  `/static/js/locale/${config.$Language}.js${versionStamp}`,\n  '/static/js/app.client.es.js' + versionStamp,\n  '/static/js/hot.reload.js' + versionStamp\n]\n"})}),"\n",(0,i.jsx)(n.h3,{id:"karma-removed-instead-of-that-added-jest",children:"Karma removed instead of that added Jest"}),"\n",(0,i.jsx)(n.p,{children:"If you are overriding gulpfile.js you need to make following changes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["remove from gulpConfig.tasks.dev task ",(0,i.jsx)(n.code,{children:"test:unit:karma:dev"})]}),"\n",(0,i.jsxs)(n.li,{children:["remove from gulpConfig.tasks.dev and gulpConfig.tasks.build task ",(0,i.jsx)(n.code,{children:"Es6ToEs5:vendor:client:test"})]}),"\n",(0,i.jsxs)(n.li,{children:["remove from function buildExample task ",(0,i.jsx)(n.code,{children:"Es6ToEs5:vendor:client:test"})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["If you are overriding gulpConfig.tasks.build in gulpConfig.js you need to add ",(0,i.jsx)(n.code,{children:"bundle:es:app"})," into bundles section."]}),"\n",(0,i.jsx)(n.h2,{id:"server",children:"Server"}),"\n",(0,i.jsx)(n.p,{children:"In server.js"}),"\n",(0,i.jsx)(n.p,{children:"Add at the top into import sections:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"require('ima/polyfill/imaLoader.js');\nrequire('ima/polyfill/imaRunner.js');\n"})}),"\n",(0,i.jsx)(n.p,{children:"add proxy into middlewares imports section"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"let proxy = require('express-http-proxy');\n"})}),"\n",(0,i.jsx)(n.p,{children:"change line"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:".use(environment.$Proxy.path + '/', proxy)\n"})}),"\n",(0,i.jsx)(n.p,{children:"to"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:".use(environment.$Proxy.path + '/', proxy(environment.$Proxy.server))\n"})}),"\n",(0,i.jsx)(n.h2,{id:"documentview",children:"DocumentView"}),"\n",(0,i.jsx)(n.p,{children:"In DocumentView.jsx we united sync and async scripts."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["remove ",(0,i.jsx)(n.code,{children:"getSyncScripts"})," function."]}),"\n",(0,i.jsxs)(n.li,{children:["update ",(0,i.jsx)(n.code,{children:"getAsyncScripts"})," function to"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"getAsyncScripts() {\n  let scriptResources = `<script>\n  function checkAsyncAwait () {\n    try {\n      new Function('(async () => ({}))()');\n      return true;\n    } catch (e) {\n      return false;\n    }\n  }\n  $IMA.Runner = $IMA.Runner || {};\n  if (Object.values && checkAsyncAwait()) {\n    $IMA.Runner.scripts = [\n      ${this.utils.$Settings.$Page.$Render.esScripts\n  .map(script => `'${script}'`)\n  .join()}\n      ];\n  } else {\n    $IMA.Runner.scripts = [\n      ${this.utils.$Settings.$Page.$Render.scripts\n  .map(script => `'${script}'`)\n  .join()}\n      ];\n  }\n\n  if (!window.fetch) {\n    $IMA.Runner.scripts.unshift('${this.utils.$Settings.$Static\n  .js}/fetch-polyfill.js');\n  }\n\n  $IMA.Runner.scripts.forEach(function(source) {\n    var script = document.createElement('script');\n    script.async = $IMA.$Env !== 'dev';\n    script.onload = $IMA.Runner.load;\n    script.src = source;\n\n    document.getElementById('scripts').appendChild(script);\n  });\n  <\/script>`;\n\n  return scriptResources;\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"replace"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-jsx",children:"{this.utils.$Settings.$Env === 'dev' ?\n  <div id='scripts'>{this.getSyncScripts()}</div>\n:\n  <div id='scripts' dangerouslySetInnerHTML={\n    { __html: this.getAsyncScripts() }\n  }/>\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"with"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-jsx",children:"<div id='scripts' dangerouslySetInnerHTML={\n  { __html: this.getAsyncScripts() }\n}/>\n"})}),"\n",(0,i.jsx)(n.h2,{id:"spa",children:"SPA"}),"\n",(0,i.jsxs)(n.p,{children:["In ",(0,i.jsx)(n.code,{children:"app/assets/static/html/spa.html"})," add ima-polyfill."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/seznam/ima/tree/master/packages/create-ima-app/examples/hello/assets/static/html/spa.html#L42",children:"https://github.com/seznam/ima/tree/master/packages/create-ima-app/examples/hello/assets/static/html/spa.html#L42"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/seznam/ima/tree/master/packages/create-ima-app/examples/hello/assets/static/html/spa.html#L47",children:"https://github.com/seznam/ima/tree/master/packages/create-ima-app/examples/hello/assets/static/html/spa.html#L47"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"removed-namespaces",children:"Removed namespaces"}),"\n",(0,i.jsx)(n.p,{children:"If you extends some view from ns.ima.page.AbstractComponent, you need to add this import:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"import AbstractComponent from 'ima/page/AbstractComponent';\n"})}),"\n",(0,i.jsx)(n.p,{children:"and use AbstractComponent instead of ns.ima.page.AbstractComponent."}),"\n",(0,i.jsx)(n.p,{children:"If you extends some view from ns.ima.controller.AbstractController, you need to add this import:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"import AbstractController from 'ima/controller/AbstractController';\n"})}),"\n",(0,i.jsx)(n.p,{children:"and use AbstractController instead of ns.ima.controller.AbstractController."}),"\n",(0,i.jsx)(n.p,{children:"In settings.js import your DocumentView like this:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"import DocumentView from 'app/component/document/DocumentView';\n"})}),"\n",(0,i.jsx)(n.p,{children:"Now you need to replace your documentView namespace with React component"}),"\n",(0,i.jsx)(n.p,{children:"so for this step replace your configuration.prod.$Page.$Render.documentView to DocumentView."}),"\n",(0,i.jsx)(n.h2,{id:"others",children:"Others"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["IMA.js is now using React 16 where is no longer supported ",(0,i.jsx)(n.code,{children:"react-addons-perf"})," package in case you were using it."]}),"\n",(0,i.jsxs)(n.li,{children:["There was added a fetchOptions property to the IMA.js' http. You can add this property into your settings.js file\nto the ",(0,i.jsx)(n.code,{children:"$Http.defaultRequestOptions"})," object. The property represents the second and optional parameter of the fetch method\n",(0,i.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch",children:"https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch"})," - an options object containing\nsettings that you want to apply to the Fetch API ",(0,i.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API",children:"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API"})," request."]}),"\n",(0,i.jsx)(n.li,{children:"There is a breaking change in the IMA.js' router. Now there is defined an order where mandatory parameters have to be before optional parameters."}),"\n",(0,i.jsx)(n.li,{children:"There are no longer available Request and Response at the client side."}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},3023:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>o});var t=s(3696);const i={},r=t.createContext(i);function a(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);