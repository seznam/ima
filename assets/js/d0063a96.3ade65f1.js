"use strict";(self.webpackChunk_ima_docs=self.webpackChunk_ima_docs||[]).push([[7084],{9351:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"cli/compiler-features","title":"Compiler features","description":"CLI > Compiler features","source":"@site/../docs/cli/compiler-features.md","sourceDirName":"cli","slug":"/cli/compiler-features","permalink":"/cli/compiler-features","draft":false,"unlisted":false,"editUrl":"https://github.com/seznam/ima/tree/master/docs/../docs/cli/compiler-features.md","tags":[],"version":"current","lastUpdatedBy":"Jan \u0160ime\u010dek","lastUpdatedAt":1761308686000,"frontMatter":{"title":"Compiler features","description":"CLI > Compiler features"},"sidebar":"docs","previous":{"title":"Introduction to @ima/cli","permalink":"/cli/"},"next":{"title":"ima.config.js","permalink":"/cli/ima-config-js"}}');var t=s(2540),o=s(3023);const r={title:"Compiler features",description:"CLI > Compiler features"},l=void 0,c={},a=[{value:"Server and client bundles",id:"server-and-client-bundles",level:2},{value:"Filesystem Cache",id:"filesystem-cache",level:2},{value:"JavaScript/React",id:"javascriptreact",level:2},{value:"React",id:"react",level:3},{value:"Typescript",id:"typescript",level:2},{value:"CSS/LESS",id:"cssless",level:2},{value:"CSS Modules",id:"css-modules",level:3},{value:"globals.less",id:"globalsless",level:3},{value:"Glob less imports",id:"glob-less-imports",level:3},{value:"PostCSS",id:"postcss",level:3},{value:"Assets",id:"assets",level:2},{value:"Images",id:"images",level:3},{value:"Text files",id:"text-files",level:3},{value:"Source Imports",id:"source-imports",level:2},{value:"JavaScript and TypeScript as Strings",id:"javascript-and-typescript-as-strings",level:3},{value:"CSS and LESS as Strings",id:"css-and-less-as-strings",level:3},{value:"Iframe with Inline Content",id:"iframe-with-inline-content",level:3},{value:"Dynamic Loading with Code Splitting",id:"dynamic-loading-with-code-splitting",level:3},{value:"Important Notes",id:"important-notes",level:3},{value:"Handling External Dependencies",id:"handling-external-dependencies",level:3},{value:"Option 1: Use CDN Dependencies in Iframe",id:"option-1-use-cdn-dependencies-in-iframe",level:4},{value:"Option 2: Create Self-Contained Modules",id:"option-2-create-self-contained-modules",level:4},{value:"Option 3: Bundle Dependencies Externally",id:"option-3-bundle-dependencies-externally",level:4},{value:"<code>./app/public</code> folder",id:"apppublic-folder",level:3},{value:"Compression",id:"compression",level:2},{value:"Languages",id:"languages",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["The IMA.js CLI uses ",(0,t.jsx)(n.a,{href:"https://webpack.js.org/",children:"webpack"})," behind the scenes to ",(0,t.jsx)(n.strong,{children:"compile"}),", ",(0,t.jsx)(n.strong,{children:"minify"})," and ",(0,t.jsx)(n.strong,{children:"run"})," the application in ",(0,t.jsx)(n.strong,{children:"dev mode"}),". It comes pre-configured with some options, plugins and loaders, which are described in the following sections."]}),"\n",(0,t.jsx)(n.h2,{id:"server-and-client-bundles",children:"Server and client bundles"}),"\n",(0,t.jsxs)(n.p,{children:["The CLI creates 3 separate bundles (",(0,t.jsx)(n.em,{children:"2 in dev mode for performance reasons"}),") with their own configurations. One ",(0,t.jsx)(n.code,{children:"server"})," bundle (used in express for SSR) and two client bundles - ",(0,t.jsx)(n.code,{children:"client"})," and ",(0,t.jsx)(n.code,{children:"client.es"}),", where one targets the ",(0,t.jsx)(n.code,{children:"es2018"})," and the other ",(0,t.jsx)(n.code,{children:"es2022"})," version of the javascript."]}),"\n",(0,t.jsxs)(n.p,{children:["This can be further customized using the ",(0,t.jsx)(n.a,{href:"/cli/ima-config-js#disablelegacybuild",children:(0,t.jsxs)(n.strong,{children:[(0,t.jsx)(n.code,{children:"disableLegacyBuilt"})," option in ",(0,t.jsx)(n.code,{children:"ima.config.js"})]})}),"."]}),"\n",(0,t.jsxs)(n.admonition,{type:"tip",children:[(0,t.jsxs)(n.p,{children:["To make the CLI build ",(0,t.jsx)(n.strong,{children:"both es versions"})," in dev mode, run it with ",(0,t.jsx)(n.code,{children:"npx ima dev --legacy"})," option."]}),(0,t.jsxs)(n.p,{children:["Keep in mind that ",(0,t.jsx)(n.a,{href:"https://webpack.js.org/concepts/hot-module-replacement/",children:"hot module replacement (HMR)"})," is configured to work only with the latest es version (manual browser reload is required to see any changes on the legacy version)."]})]}),"\n",(0,t.jsx)(n.h2,{id:"filesystem-cache",children:"Filesystem Cache"}),"\n",(0,t.jsxs)(n.p,{children:["The webpack ",(0,t.jsx)(n.a,{href:"https://webpack.js.org/configuration/cache/#cache",children:"filesystem cache"})," feature is enabled by default to improve consecutive build times in development and production mode."]}),"\n",(0,t.jsxs)(n.p,{children:["The CLI automatically generates cache key based on used set of CLI options, which somehow affect the produced output. Not all options affect cache key generation, however you may notice that sometimes the build speeds can behave as if there is no filesystem cache. To see which options affect the cache key generation, ",(0,t.jsxs)(n.a,{href:"https://github.com/seznam/ima/blob/next/packages/cli/src/webpack/utils.ts#L154",children:["take a look at the ",(0,t.jsx)(n.code,{children:"createCacheKey()"})," function"]}),"."]}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["Note that each command and bundle maintains it's own set of coexisting cache. To clear the cache, use ",(0,t.jsx)(n.code,{children:"--clearCache"})," option in ",(0,t.jsx)(n.code,{children:"build"})," or ",(0,t.jsx)(n.code,{children:"dev"})," commands."]})}),"\n",(0,t.jsx)(n.h2,{id:"javascriptreact",children:"JavaScript/React"}),"\n",(0,t.jsxs)(n.p,{children:["To bundle JS files we opted to use ",(0,t.jsx)(n.a,{href:"https://swc.rs/",children:"swc"}),", a Rust-based JavaScript compiler. This decision was based on our results from testing and measuring build times, where we saw 2-3 times the speed benefit (depending on the application size) of using swc over babel compiler."]}),"\n",(0,t.jsxs)(n.p,{children:["By default the application ",(0,t.jsx)(n.strong,{children:"compiles both"}),", the ",(0,t.jsx)(n.strong,{children:"application files"})," (sourced from ",(0,t.jsx)(n.code,{children:"./app"})," folder) and ",(0,t.jsx)(n.strong,{children:"vendor files"})," (sourced from ",(0,t.jsx)(n.code,{children:"./node_modules"})," directory) to make sure that it can run in targeted environments without any issues."]}),"\n",(0,t.jsxs)(n.p,{children:['The swc compiler is configured to leverage the power of "env" functionality (preset-env in babel), in combination with ',(0,t.jsx)(n.a,{href:"https://github.com/zloirock/core-js",children:"core-js"})," to ",(0,t.jsx)(n.strong,{children:"automatically polyfill missing APIs"})," that are used throughout the codebase, that the targeted environment doesn't support."]}),"\n",(0,t.jsxs)(n.p,{children:["This configuration can be easily customized using ",(0,t.jsx)(n.a,{href:"./ima.config.js#swc",children:"swc option in ima.config.js"}),"."]}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["This means that you can write your code ",(0,t.jsx)(n.strong,{children:"using the latest and greatest from the ECMAscript language"})," and the swc makes sure to compile these features down to the latest supported syntax or automatically inject core-js polyfills."]})}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsxs)(n.p,{children:["Keep in mind that overuse of these may result in larger JS bundles due to the need to inject more core-js polyfills. Also browser APIs like for example ",(0,t.jsx)(n.code,{children:"AbortController"})," or ",(0,t.jsx)(n.code,{children:"fetch"})," are not handled by the core-js and must be included manually. ",(0,t.jsx)(n.a,{href:"./advanced-features#polyfilljs",children:"See polyfills in advanced features section"}),"."]})}),"\n",(0,t.jsx)(n.h3,{id:"react",children:"React"}),"\n",(0,t.jsxs)(n.p,{children:["In dev we use the development version of react library (for better debugging) and ",(0,t.jsx)(n.code,{children:"react-refresh"})," for HMR. This is switched to production for production builds. By default the compiler is configured to work with ",(0,t.jsx)(n.a,{href:"https://reactjs.org/blog/2020/09/22/introducing-the-new-jsx-transform.html",children:"automatic"})," JSX runtime, so there's no need to import ",(0,t.jsx)(n.code,{children:"react"})," library at top of every jsx file. This can be changed to ",(0,t.jsx)(n.code,{children:"classic"})," in ",(0,t.jsx)(n.a,{href:"/cli/ima-config-js#jsxruntime",children:"ima.config.js"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"typescript",children:"Typescript"}),"\n",(0,t.jsxs)(n.p,{children:["From IMA.js v18 we've introduced ",(0,t.jsx)(n.strong,{children:"support for Typescript in your application code"}),". To enable it, simply install ",(0,t.jsx)(n.code,{children:"typescript"})," dependency and create ",(0,t.jsx)(n.code,{children:"tsconfig.json"})," file in the root of your project."]}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["For more information and additional tips about TypeScript usage in IMA.js applications, ",(0,t.jsx)(n.a,{href:"/basic-features/typescript",children:(0,t.jsx)(n.strong,{children:"see the TypeScript section"})}),"."]})}),"\n",(0,t.jsx)(n.h2,{id:"cssless",children:"CSS/LESS"}),"\n",(0,t.jsxs)(n.p,{children:["There's built in support for CSS and LESS preprocessor. Both of these have the same featureset. To use any CSS you have to import the files anywhere in your application. These imports are then combined and extracted to single ",(0,t.jsx)(n.code,{children:"app.css"})," file."]}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"./app/main.js"})," is a good place to use for global CSS files, since it is an entry point to IMA.js application and these imports will be included at top of the built ",(0,t.jsx)(n.code,{children:"app.css"})," file."]})}),"\n",(0,t.jsx)(n.h3,{id:"css-modules",children:"CSS Modules"}),"\n",(0,t.jsxs)(n.p,{children:["Both loaders fully support ",(0,t.jsx)(n.a,{href:"https://github.com/css-modules/css-modules",children:"CSS Modules"})," for files with ",(0,t.jsx)(n.code,{children:"*.modules.css"})," or ",(0,t.jsx)(n.code,{children:"*.modules.less"})," postfixes, with ",(0,t.jsx)(n.code,{children:"local"})," as default scoping."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-less",metastring:"title=./app/page/home/home.module.less",children:":global {\n  :root: {\n    --bg-color: #fff;\n  }\n}\n\n.home {\n  background: var(--bg-color);\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",metastring:"title=./app/page/home/Home.jsx",children:"import styles from './home.module.less';\n\nfunction Home() {\n  return\n    <div className={styles.home}>HomePage</div>\n  );\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"globalsless",children:"globals.less"}),"\n",(0,t.jsxs)(n.p,{children:["This file is located at ",(0,t.jsx)(n.code,{children:"./app/less/globals.less"})," and it is automatically imported on top of every other processed LESS file. It allows you to easily share globals across less files."]}),"\n",(0,t.jsxs)(n.admonition,{type:"tip",children:[(0,t.jsxs)(n.p,{children:["Use this file to import other ",(0,t.jsx)(n.strong,{children:"mixins"})," and ",(0,t.jsx)(n.strong,{children:"global variables"})," which are then available in all other *.less files automatically, without the need to import them explicitly."]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-less",metastring:"title=./app/less/globals.less",children:"@import './mixins/*.less';\n\n@global-red: red;\n"})}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-less",metastring:"title=./app/less/app.less",children:"body {\n  // No direct import of 'globals.less' is needed.\n  background: @global-red;\n}\n"})})]}),"\n",(0,t.jsx)(n.h3,{id:"glob-less-imports",children:"Glob less imports"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"less-loader"})," uses ",(0,t.jsx)(n.a,{href:"https://github.com/just-boris/less-plugin-glob",children:"less-plugin-glob"})," by default in it's configuration. This means that glob imports are fully supported."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-less",metastring:"title=./app/less/app.less",children:'@import \'./mixins/*.less\';\n\n/* Non-relative imports are resolved through node resolver. */\n@import "@ima/**/atoms/**/*.less";\n@import "@ima/**/molecules/**/*.less";\n@import "@ima/**/organisms/**/*.less";\n'})}),"\n",(0,t.jsx)(n.h3,{id:"postcss",children:"PostCSS"}),"\n",(0,t.jsxs)(n.p,{children:["IMA.js has built-in support for ",(0,t.jsx)(n.a,{href:"https://postcss.org/",children:"PostCSS"})," during CSS/LESS compilation."]}),"\n",(0,t.jsx)(n.p,{children:"Out of the box without any additional configuration, it comes pre-configured with following plugins:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://github.com/luisrudge/postcss-flexbugs-fixes#readme",children:"postcss-flexbugs-fixes"})," - tries to fix all known flexbox issues."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://github.com/csstools/postcss-plugins/tree/main/plugin-packs/postcss-preset-env",children:"postcss-preset-env"})," - converts modern CSS back into something the old browsers can understand (back to IE11). It comes with: ",(0,t.jsx)(n.code,{children:"autoprefixer"}),", ",(0,t.jsx)(n.code,{children:"stage 3"})," and ",(0,t.jsx)(n.code,{children:"custom-properties: false"})," features."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["All these features can be easily customized using ",(0,t.jsx)(n.code,{children:"postcss"})," option in ",(0,t.jsx)(n.a,{href:"./ima.config.js.md/#postcss",children:"ima.config.js"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"assets",children:"Assets"}),"\n",(0,t.jsxs)(n.p,{children:["All other assets are either ",(0,t.jsx)(n.strong,{children:"inlined"})," as ",(0,t.jsx)(n.strong,{children:"base64 encoded string"})," or copied to the ",(0,t.jsx)(n.code,{children:"./build/static/media"})," folder, where default import represents assets's public URL."]}),"\n",(0,t.jsx)(n.h3,{id:"images",children:"Images"}),"\n",(0,t.jsxs)(n.p,{children:["Images (bmp, gif, jpeg, png, webp, svg) are automatically inlined if their size is below ",(0,t.jsx)(n.code,{children:"imageInlineSizeLimit"}),", which can be configured in ",(0,t.jsx)(n.a,{href:"/cli/ima-config-js#imageinlinesizelimit",children:"ima.config.js"}),", with default value of ",(0,t.jsx)(n.strong,{children:"8Kb"}),". Images exceeding this size limit are copied to the static media folder and import return's their public URL."]}),"\n",(0,t.jsxs)(n.p,{children:["To enforce either one of the two modes, you can use ",(0,t.jsx)(n.code,{children:"?external"})," or ",(0,t.jsx)(n.code,{children:"?inline"})," query parameter in the import path:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"// This always converts the image to base64 encoded string and inlines it.\nimport InlineImage from './image.png?inline';\n\n// This always returns image public URL, no matter it's size\nimport ImageURL from './image.png?external';\n"})}),"\n",(0,t.jsx)(n.h3,{id:"text-files",children:"Text files"}),"\n",(0,t.jsxs)(n.p,{children:["When you import one of these text files - csv, txt, html, you receive their contents. Similarly to the images, you can enforce getting their public URL by using the ",(0,t.jsx)(n.code,{children:"?external"})," query parameter."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"// Returns file contents in the default import\nimport IndexSource from './index.html';\n\n// Returns the file public URL\nimport IndexURL from './index.html?external';\n"})}),"\n",(0,t.jsx)(n.h2,{id:"source-imports",children:"Source Imports"}),"\n",(0,t.jsxs)(n.p,{children:["IMA.js CLI supports importing JavaScript, TypeScript, CSS, and LESS files as ",(0,t.jsx)(n.strong,{children:"compiled strings"})," using the ",(0,t.jsx)(n.code,{children:"?source"})," query parameter. This feature allows you to dynamically inject scripts and styles into your application without bundling them into the main bundle."]}),"\n",(0,t.jsx)(n.h3,{id:"javascript-and-typescript-as-strings",children:"JavaScript and TypeScript as Strings"}),"\n",(0,t.jsx)(n.p,{children:"You can import compiled JavaScript or TypeScript code as strings, which is useful for creating dynamic content, iframes with custom scripts, or conditional loading of code."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"// Import compiled JavaScript as string\nimport scriptCode from './analytics.js?source';\nimport widgetCode from './widget.ts?source';\n\n// Use in React component\nfunction AnalyticsWidget() {\n  useEffect(() => {\n    // Inject script dynamically\n    const script = document.createElement('script');\n    script.textContent = scriptCode;\n    document.head.appendChild(script);\n  }, []);\n\n  return <div id=\"analytics-widget\" />;\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"css-and-less-as-strings",children:"CSS and LESS as Strings"}),"\n",(0,t.jsx)(n.p,{children:"Import compiled CSS or LESS as strings for dynamic styling, iframe content, or component-specific styles that shouldn't be in the main bundle."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"// Import compiled CSS/LESS as strings\nimport widgetStyles from './widget.less?source';\nimport componentCSS from './component.css?source';\n\n// Use for dynamic styling\nfunction CustomWidget() {\n  useEffect(() => {\n    // Inject styles dynamically\n    const style = document.createElement('style');\n    style.textContent = widgetStyles;\n    document.head.appendChild(style);\n  }, []);\n\n  return <div className=\"custom-widget\">Widget content</div>;\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"iframe-with-inline-content",children:"Iframe with Inline Content"}),"\n",(0,t.jsx)(n.p,{children:"A common use case is creating iframes with custom HTML, CSS, and JavaScript content without external files:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'import adScript from \'./ad-tracker.js?source\';\nimport adStyles from \'./ad-banner.less?source\';\nimport adContent from \'./content.txt\';\n\nfunction AdBanner() {\n  const iframeRef = useRef(null);\n\n  useEffect(() => {\n    if (iframeRef.current) {\n      const iframeDoc = iframeRef.current.contentDocument;\n\n      // Create complete HTML document\n      const htmlContent = `\n        <!DOCTYPE html>\n        <html>\n          <head>\n            <style>${adStyles}</style>\n          </head>\n          <body>\n            <div class="ad-container">\n              ${adContent}\n            </div>\n            <script>${adScript}<\/script>\n          </body>\n        </html>\n      `;\n\n      iframeDoc.open();\n      iframeDoc.write(htmlContent);\n      iframeDoc.close();\n    }\n  }, [adContent]);\n\n  return (\n    <iframe\n      ref={iframeRef}\n      width="300"\n      height="250"\n      frameBorder="0"\n      sandbox="allow-scripts allow-same-origin"\n    />\n  );\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"dynamic-loading-with-code-splitting",children:"Dynamic Loading with Code Splitting"}),"\n",(0,t.jsx)(n.p,{children:"Source imports work with dynamic imports for code splitting, allowing you to load scripts and styles only when needed:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"// Lazy load widget code and styles\nasync function loadWidget() {\n  const [\n    { default: widgetScript },\n    { default: widgetStyles }\n  ] = await Promise.all([\n    import('./widget.js?source'),\n    import('./widget.less?source')\n  ]);\n\n  // Inject styles\n  const style = document.createElement('style');\n  style.textContent = widgetStyles;\n  document.head.appendChild(style);\n\n  // Execute widget script\n  const script = document.createElement('script');\n  script.textContent = widgetScript;\n  document.head.appendChild(script);\n}\n\nfunction LazyWidget() {\n  const [loaded, setLoaded] = useState(false);\n\n  const handleLoad = async () => {\n    await loadWidget();\n    setLoaded(true);\n  };\n\n  return (\n    <div>\n      {!loaded && <button onClick={handleLoad}>Load Widget</button>}\n      <div id=\"widget-container\" />\n    </div>\n  );\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"important-notes",children:"Important Notes"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Compilation"}),": Source imports go through the same compilation pipeline as regular imports (SWC for JS/TS, PostCSS + LESS for styles)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Source Maps"}),": Source maps are included when ",(0,t.jsx)(n.code,{children:"useSourceMaps"})," is enabled in development"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Minification"}),": CSS is automatically minified in production builds"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"CSS Modules"}),": CSS Modules work with source imports, though the class names are included in the string"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Dependencies"}),": External dependencies (npm packages) are ",(0,t.jsx)(n.strong,{children:"not automatically included"})," in source imports due to webpack's code splitting"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"handling-external-dependencies",children:"Handling External Dependencies"}),"\n",(0,t.jsx)(n.p,{children:"When using external dependencies in source imports for iframe usage, you have several options:"}),"\n",(0,t.jsx)(n.h4,{id:"option-1-use-cdn-dependencies-in-iframe",children:"Option 1: Use CDN Dependencies in Iframe"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'import widgetScript from \'./widget.js?source\'; // Contains: import _ from \'lodash\';\n\nfunction IframeWidget() {\n  const iframeRef = useRef(null);\n\n  useEffect(() => {\n    if (iframeRef.current) {\n      const iframeDoc = iframeRef.current.contentDocument;\n\n      const htmlContent = `\n        <!DOCTYPE html>\n        <html>\n          <head>\n            \x3c!-- Load dependencies from CDN --\x3e\n            <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"><\/script>\n          </head>\n          <body>\n            <div id="widget-container"></div>\n            <script>\n              // Your compiled widget code can now use lodash\n              ${widgetScript}\n            <\/script>\n          </body>\n        </html>\n      `;\n\n      iframeDoc.open();\n      iframeDoc.write(htmlContent);\n      iframeDoc.close();\n    }\n  }, []);\n\n  return <iframe ref={iframeRef} width="300" height="250" />;\n}\n'})}),"\n",(0,t.jsx)(n.h4,{id:"option-2-create-self-contained-modules",children:"Option 2: Create Self-Contained Modules"}),"\n",(0,t.jsx)(n.p,{children:"Avoid external dependencies in source imports by creating self-contained utilities:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"// utils.js?source - Self-contained, no external dependencies\nexport function formatCurrency(amount) {\n  return new Intl.NumberFormat('en-US', {\n    style: 'currency',\n    currency: 'USD'\n  }).format(amount);\n}\n\nexport function debounce(func, wait) {\n  let timeout;\n  return function executedFunction(...args) {\n    const later = () => {\n      clearTimeout(timeout);\n      func(...args);\n    };\n    clearTimeout(timeout);\n    timeout = setTimeout(later, wait);\n  };\n}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"option-3-bundle-dependencies-externally",children:"Option 3: Bundle Dependencies Externally"}),"\n",(0,t.jsx)(n.p,{children:"Load both the dependencies and your code separately:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"// Load vendor bundle and your code separately\nfunction IframeWidget() {\n  useEffect(() => {\n    const iframe = document.createElement('iframe');\n\n    iframe.srcdoc = `\n      <html>\n        <body>\n          <script src=\"/static/js/vendors.js\"><\/script>\n          <script>${widgetScript}<\/script>\n        </body>\n      </html>\n    `;\n\n    document.body.appendChild(iframe);\n  }, []);\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"This feature provides powerful flexibility for creating dynamic content, third-party widgets, email templates, and any scenario where you need compiled code as strings rather than executed modules."}),"\n",(0,t.jsxs)(n.h3,{id:"apppublic-folder",children:[(0,t.jsx)(n.code,{children:"./app/public"})," folder"]}),"\n",(0,t.jsxs)(n.p,{children:["Everything in this folder is copied to the ",(0,t.jsx)(n.code,{children:"./build/static/public"})," and available through the express static files route (",(0,t.jsx)(n.code,{children:"http://localhost:3001/static/public/"}),")."]}),"\n",(0,t.jsx)(n.h2,{id:"compression",children:"Compression"}),"\n",(0,t.jsxs)(n.p,{children:["When you built the application bundle, all static assets are additionally compressed using ",(0,t.jsx)(n.code,{children:"brotli"})," and ",(0,t.jsx)(n.code,{children:"gzip"})," compression (with ",(0,t.jsx)(n.code,{children:".br"})," and ",(0,t.jsx)(n.code,{children:".gz"})," extensions respectively). To customize this behavior, take a look at ",(0,t.jsx)(n.a,{href:"/cli/ima-config-js#compress",children:"ima.config.js"})," configuration section."]}),"\n",(0,t.jsx)(n.h2,{id:"languages",children:"Languages"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.a,{href:"/cli/ima-config-js#languages",children:"language files"})," are compile using ",(0,t.jsx)(n.a,{href:"http://messageformat.github.io/messageformat/",children:"messageformat"})," library."]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},3023:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>l});var i=s(3696);const t={},o=i.createContext(t);function r(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);